<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link href="index.css" rel="stylesheet" />
  <title>DAC Exo6</title>
</head>
<body>
  <header>
    <h1>DAC Exo6</h1>
    <p class="subtitle">#Animation #Simulation #WIP</p>
  </header>
  <main>
    <form autocomplete="off" spellcheck="false">
      <fieldset>

        <div id="user-vars">
          <b>SÃ©maphores</b>
            {<input name="sema-names" type="text" value="sFeu, sVide, sUnlucky" />}
            =
            {<input name="sema-vals" type="text" value="1, 1, 13" />}
          <br />
          <b>Entiers</b>
            {<input name=int-names type="text" value="feu" />}
            =
            {<input name="int-vals" type="text" value="1" />}
        </div>

        <table>
          <tr>
            <th>Changement</th>
            <th>Traversee1</th>
            <th>Traversee2</th>
          </tr>
          <tr>
            <td><textarea title="<lineNum>: <Error message goes here>" id="changement">p(sFeu);
if (feu == 1) { >.<
  feu = 2
} else {
  feu = 1
}
v(sFeu)
            </textarea></td>
            <td><textarea id="traversee1">p(sFeu)
if (feu == 1) {
  p(sVide)
  p(sUnlucky)
  circuler()
  v(sVide)
}
v(sFeu)
            </textarea></td>
            <td><textarea id="traversee2">p(sFeu)
if (feu == 2) {
  p(sVide)
  circuler()
  v(sVide)
}
v(sFeu)
                </textarea></td>
          </tr>
        </table>

        <div id="buttons">
          <input type="submit" value="Start!" />
          <button>Stop</button>
          <input type="reset" value="Load my attempt" />
          <button>Load correct solution</button>
        </div>

      </fieldset>
    </form>

    <div id="sim">
      <span id="feu1" class="feu green"></span>
      <div id="voi1"></div>

      <div id="intersection"></div>

      <span id="feu2" class="feu red"></span>
      <div id="voi2"></div>
    </div>

  </main>

  <section>
    <h2>Ideas...</h2>
    <pre>
    - *Must* write everything in French ._.
    
    - Force user to declare 'feu' as `enum {1, 2}` (see the Problem section).

    - If there's an error in (or an exception is raised from) a user's provided code, highlight the offending part and add an error message as a 'title' attribute.

    - Sorting each road's cars with multiple queues is tricky:
    create ordering priority depending on calls to p()
    like 'p(sFeu); p(sVide); ...' creates `orderVec=['sFeu', 'sVide']` that will be used to sort it in its road.
    - To pop or not to pop? Add both variants? Inform the user to pay attention?
    - pop is simple but bad if you use conditions. Similar problems happen if you don't pop...
    - Instead of pop()'ing, replace sema with -Infinity?
    - p() unshift()s a val into orderVec?
    
    * Animation:
    - Idea: just output states as JSON, and think of the actual rendering later?
    - Using: https://developer.mozilla.org/en-US/docs/Web/CSS/order
    - Interesting: https://stackoverflow.com/questions/8123525/using-jquery-to-re-order-and-animate-list-items

    - When a car leaves intersection, make it fade after some time then destroy its instance.

    - If car touches intersection, make it yellow.

    - If two cars collide, stop everything(!) and make the screen red(?)
    </pre>
  </section>

  <section>
    <h2>Problem / Exo</h2>
    <pre>
    ...
    </pre>
  </section>
  
  <section>
    <h2>Notes</h2>
    <pre>
    * It makes use of:
      - JavaScript's `eval` and `with` features which are deprecated and very discouraged
      - Lodash for some FP functions (mapping and zipping stuff...)
      - some Promise-based and queue-based semaphore [TBD] (find an implementation that supports `getPosition(obj)` and `getName()`, fork one, or write my own thing)
      - Phaser: a game engine [MAYBE] (for collusion detection and animation maybe)
    
    * Why?
      - To learn Phaser(?)
      - To practice DAC(?)
    </pre>
  </section>

  <section>
    <h2>Credits</h2>
    <pre>
    - {City car, Truck, Traffic lights green, Traffic lights red} icon by <a href="http://delapouite.com">Delapouite</a> under CC BY 3.0
    </pre>
  </section>
  
  <section>
    <h2>Refs</h2>
    <pre>
    - B. P. Miller, <i>What to Draw? When to Draw? An Essay on Parallel Program Visualization</i>
    - Wikipedia, Queueing Theory, networks and network jams
    </pre>
  </section>

  <script src="scripts/lodash.js"></script>
  <script src="index.js"></script>
</body>
</html>
