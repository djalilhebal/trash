<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link href="index.css" rel="stylesheet" />
  <title>DAC Exo6</title>
</head>
<body>
  <header>
    <h1>DAC Exo6</h1>
    <p class="subtitle">#Animation #Simulation #WIP</p>
  </header>
  <main>
    <form autocomplete="off" spellcheck="false">
      <fieldset>

        <div id="user-vars">
          <b>Sémaphores</b>
            {<input name="sema-names" type="text" value="sFeu1, sFeu2, sVide1, sVide2" />}
            =
            {<input name="sema-vals" type="text" value="1, 0, 1, 1" />}
          <br />
          <b>Entiers</b>
            {<input name=int-names type="text" value="feu" />}
            =
            {<input name="int-vals" type="text" value="1" />}
        </div>

        <table>
          <tr>
            <th>Changement</th>
            <th>Traversee1</th>
            <th>Traversee2</th>
          </tr>
          <tr>
            <td>
<textarea id="changement">while (true) {
  sleep(10)
  if (feu == 1) {
    p(sFeu1)
    feu = 2
    v(sFeu2)
  } else {
    p(sFeu2)
    feu = 1
    v(sFeu1)
  }
}</textarea>
            </td>
            <td>
<textarea id="traversee1">p(sVide1)
p(sFeu1)
circuler()
v(sFeu1)
v(sVide1)</textarea>
            </td>
            <td>
<textarea id="traversee2">p(sVide2)
p(sFeu2)
circuler()
v(sFeu2)
v(sVide2)</textarea>
            </td>
          </tr>
        </table>

        <div id="buttons">
          <input id="btn-start" type="submit" value="Start!" />
          <button id="btn-stop" disabled>Stop</button>
          <button id="btn-load-attempt" disabled>Load my attempt</button>
          <button id="btn-load-correct" disabled>Load correct solution</button>
        </div>

      </fieldset>
    </form>

    <div id="sim" data-feu="0">
      <span id="feu1" title="feu == 1"></span>
      <div id="voie1" title="voie 1"></div>

      <div id="carrefour" title="carrefour" data-state="normal"></div>

      <span id="feu2" title="feu == 2"></span>
      <div id="voie2" title="voie 2"></div>
    </div>

  </main>

  <section>
    <h2>Ideas...</h2>
    <pre>
    - TODO: Force user to declare 'feu' as `enum {1, 2}` (see the Problem section).

    - Sorting each road's cars with multiple queues is tricky:
    create ordering priority depending on calls to p()
    like 'p(sFeu); p(sVide); ...' creates `orderVec=['sFeu', 'sVide']` that will be used to sort it in its road.
    - To pop or not to pop? Add both variants? Inform the user to pay attention?
    - pop is simple but bad if you use conditions. Similar problems happen if you don't pop...
    - p() unshift()s a val into orderVec?
    
    - If a vehicle enters the intersection, make it gray(?)
    - If two vehicles collide, stop everything(!) and make the screen red(?)
    </pre>
  </section>

  <section>
    <h2>Problem / Exo</h2>
    <pre>
    FOR FRENCH: Voir <a href="https://lipn.univ-paris13.fr/~fouquere/ENSEIGNEMENT/L2SR/TDTP_Systemes/td6.pdf">Exercice 2. Synchronisation : la circulation</a>

    Le carrefour ou le problème de la gestion des feux de circularion.
    La circulation au carrefour de deux voies est réglée par des signaux lumineux (feu vert/rouge).
    ...
    For simplicity, we are using two one-lane roads
  </pre>
  </section>
  
  <section>
    <h2>Notes</h2>
    <pre>
    * It makes use of:
      - JavaScript's `with` feature which is deprecated and very discouraged
      - AsyncFunction: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/AsyncFunction
      - CSS order: https://developer.mozilla.org/en-US/docs/Web/CSS/order
      - SillySemaphore: My Promise-based and queue-based semaphore (to be improved or replace; find an implementation that supports `getPosition(this)` and maybe `getName()`, or fork one)
      - Phaser: a game engine [MAYBE] (for collision detection and animation maybe)

    * Why?
      - To learn Phaser(?)
      - To practice DAC(?)

    * Tested with Brave Browser v1.1 (Chromium v79.0)
    * NOTE: Performance does not matter; if anything, we want to make things slower!
    </pre>
  </section>

  <section>
    <h2>Credits</h2>
    <pre>
    - {City car, Truck, Traffic lights green, Traffic lights red} icon by <a href="http://delapouite.com">Delapouite</a> under CC BY 3.0
    </pre>
  </section>
  
  <section>
    <h2>Refs</h2>
    <pre>
    - B. P. Miller, <i>What to Draw? When to Draw? An Essay on Parallel Program Visualization</i>
    - Wikipedia, <i>Queueing Theory</i>
    </pre>
  </section>

  <script src="index.js"></script>
</body>
</html>
